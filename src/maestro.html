<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Maestro - SelecciÃ³n de Banco</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f8fafc; text-align: center; padding: 20px; }
        .container { background: white; max-width: 800px; margin: auto; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .room-id { font-size: 40px; font-weight: bold; color: #3b82f6; }
        select { width: 100%; padding: 12px; font-size: 16px; border-radius: 8px; margin: 15px 0; border: 2px solid #e2e8f0; }
        .btn { padding: 15px 30px; font-size: 18px; border: none; border-radius: 10px; cursor: pointer; background: #10b981; color: white; width: 100%; }
        table { width: 100%; margin-top: 20px; border-collapse: collapse; }
        th, td { padding: 12px; border-bottom: 1px solid #e2e8f0; text-align: left; }
    </style>
</head>
<body>
    <div class="container">
        <div id="setup">
            <button class="btn" onclick="crearSala()">ðŸš€ INICIAR CLASE</button>
        </div>

        <div id="game-panel" style="display:none">
            <div class="room-id" id="display-room">----</div>
            
            <div style="text-align: left; margin: 20px 0;">
                <label><b>Selecciona el Banco de Preguntas:</b></label>
                <select id="subject-select"></select>
            </div>

            <button class="btn" onclick="lanzarPregunta()">ðŸ”« LANZAR PREGUNTA</button>

            <table>
                <thead>
                    <tr><th>Estudiante</th><th>Estado</th><th>Puntos</th></tr>
                </thead>
                <tbody id="student-table"></tbody>
            </table>
        </div>
    </div>

    <script>
        const socket = io('http://localhost:3000/battle');
        let currentRoom = "";

        function crearSala() { socket.emit('create-room'); }

        socket.on('room-created', data => {
            currentRoom = data.roomId;
            document.getElementById('display-room').innerText = "CÃ“DIGO: " + currentRoom;
            document.getElementById('setup').style.display = 'none';
            document.getElementById('game-panel').style.display = 'block';

            // LLENAR EL SELECT CON LOS BANCOS RECIBIDOS
            const select = document.getElementById('subject-select');
            select.innerHTML = data.subjects.map(s => 
                `<option value="${s.id}">${s.name}</option>`
            ).join('');
        });

        function lanzarPregunta() {
            const subjectId = document.getElementById('subject-select').value;
            socket.emit('start-question', { roomId: currentRoom, subjectId: subjectId });
        }

        socket.on('room-update', data => renderTable(data.students));
        socket.on('round-result', data => {
            alert("Â¡Ronda ganada por " + data.winnerName + "!");
            renderTable(data.students);
        });

        function renderTable(students) {
            const tbody = document.getElementById('student-table');
            tbody.innerHTML = students.map(s => `
                <tr>
                    <td>ðŸ‘¤ ${s.name}</td>
                    <td>${s.hasAnswered ? 'âœ… Listo' : 'ðŸ¤” Pensando...'} <small>(${s.lastResult})</small></td>
                    <td><b>${s.points}</b></td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>