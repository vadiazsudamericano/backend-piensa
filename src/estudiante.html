<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Estudiante</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; }
        .opt { display: block; width: 100%; padding: 20px; margin: 10px 0; border: 2px solid #3b82f6; border-radius: 12px; font-size: 20px; cursor: pointer; background: white; }
        .opt:disabled { background: #f1f5f9; border-color: #cbd5e1; cursor: not-allowed; }
    </style>
</head>
<body>
    <div id="login">
        <input id="name" placeholder="Tu Nombre" style="padding:15px; width:80%; margin-bottom:10px;">
        <input id="room" placeholder="Código de Sala" style="padding:15px; width:80%;">
        <button onclick="unirse()" style="padding:15px; width:88%; margin-top:10px; background:#3b82f6; color:white; border:none; border-radius:5px;">ENTRAR A LA BATALLA</button>
    </div>

    <div id="game" style="display:none">
        <h2 id="question-text">Esperando al maestro...</h2>
        <div id="options-container"></div>
    </div>

    <script>
        const socket = io('http://localhost:3000/battle');
        let myName, myRoom;

        function unirse() {
            myName = document.getElementById('name').value;
            myRoom = document.getElementById('room').value.toUpperCase();
            socket.emit('join-room', { roomId: myRoom, studentName: myName });
            document.getElementById('login').style.display = 'none';
            document.getElementById('game').style.display = 'block';
        }

        socket.on('new-question', data => {
            document.getElementById('question-text').innerText = data.text;
            const container = document.getElementById('options-container');
            container.innerHTML = data.options.map(o => `
                <button class="opt" onclick="enviar('${o.id}')">${o.text}</button>
            `).join('');
        });

        function enviar(id) {
            document.querySelectorAll('.opt').forEach(b => b.disabled = true);
            socket.emit('submit-answer', { roomId: myRoom, studentName: myName, optionId: id });
        }

        socket.on('answer-wrong', () => alert("¡Incorrecto! Más suerte la próxima."));
        socket.on('round-result', () => {
            document.getElementById('options-container').innerHTML = "";
            document.getElementById('question-text').innerText = "Ronda finalizada. ¡Mira el panel del maestro!";
        });
    </script>
</body>
</html>